<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timothy's Chess Game</title>
  <style>
    body {
      font-family: Orbitron, sans-serif;
      background-color: #f4f4f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }

    #chess-board {
      display: grid;
      grid-template-columns: repeat(8, 60px);
      grid-template-rows: repeat(8, 60px);
      gap: 1px;
      border: 2px solid black;
    }

    .square {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      text-align: center;
      cursor: pointer;
    }

    .white {
      background-color: #f0d9b5;
    }

    .black {
      background-color: #b58863;
    }

    .selected {
      outline: 3px solid yellow;
    }

    .valid-move {
      background-color: rgba(0, 255, 0, 0.4);
    }

    .capture {
      background-color: rgba(255, 0, 0, 0.4);
    }

    #status {
      margin-top: 20px;
      font-size: 1.5rem;
    }

    #toggle-guidelines {
      margin-top: 10px;
      padding: 10px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h1>Timothy's Chess Game</h1>
  <div id="chess-board"></div>
  <button id="toggle-guidelines">Toggle Guidelines</button>
  <div id="status">White's turn</div>

  <script>
    const board = [
      ["♜", "♞", "♝", "♛", "♚", "♝", "♞", "♜"],
      ["♟", "♟", "♟", "♟", "♟", "♟", "♟", "♟"],
      ["", "", "", "", "", "", "", ""],
      ["", "", "", "", "", "", "", ""],
      ["", "", "", "", "", "", "", ""],
      ["", "", "", "", "", "", "", ""],
      ["♙", "♙", "♙", "♙", "♙", "♙", "♙", "♙"],
      ["♖", "♘", "♗", "♕", "♔", "♗", "♘", "♖"],
    ];

    const boardElement = document.getElementById("chess-board");
    const statusElement = document.getElementById("status");
    const toggleGuidelinesButton = document.getElementById("toggle-guidelines");

    let selectedPiece = null;
    let selectedPosition = null;
    let currentPlayer = "white";
    let showGuidelines = true;

    const PIECES = {
      WHITE_PAWN: "♙",
      WHITE_ROOK: "♖",
      WHITE_KNIGHT: "♘",
      WHITE_BISHOP: "♗",
      WHITE_QUEEN: "♕",
      WHITE_KING: "♔",
      BLACK_PAWN: "♟",
      BLACK_ROOK: "♜",
      BLACK_KNIGHT: "♞",
      BLACK_BISHOP: "♝",
      BLACK_QUEEN: "♛",
      BLACK_KING: "♚"
    };

    toggleGuidelinesButton.addEventListener("click", () => {
      showGuidelines = !showGuidelines;
      toggleGuidelinesButton.textContent = showGuidelines ? "Hide Guidelines" : "Show Guidelines";
      if (!showGuidelines) {
        document.querySelectorAll(".valid-move, .capture").forEach((square) => {
          square.classList.remove("valid-move", "capture");
        });
      } else if (selectedPosition) {
        highlightValidMoves(selectedPosition.row, selectedPosition.col);
      }
    });

    function createBoard() {
      boardElement.innerHTML = "";
      for (let rowIndex = 0; rowIndex < 8; rowIndex++) {
        for (let colIndex = 0; colIndex < 8; colIndex++) {
          const square = document.createElement("div");
          square.className = "square " + ((rowIndex + colIndex) % 2 === 0 ? "white" : "black");
          square.dataset.row = rowIndex;
          square.dataset.col = colIndex;
          square.textContent = board[rowIndex][colIndex];
          square.addEventListener("click", () => onSquareClick(rowIndex, colIndex));
          boardElement.appendChild(square);
        }
      }
    }

    function onSquareClick(row, col) {
      const piece = board[row][col];
      console.log(`Clicked: ${piece} at (${row}, ${col}). Current player: ${currentPlayer}`);

      if (selectedPiece === null && piece && !isCurrentPlayerPiece(piece)) {
        console.log("Not your turn. Select a valid piece.");
        statusElement.textContent = `It's ${currentPlayer}'s turn.`;
        return;
      }

      if (selectedPosition && selectedPosition.row === row && selectedPosition.col === col) {
        clearSelection();
        return;
      }

      if (selectedPiece) {
        if (movePiece(row, col)) {
          currentPlayer = currentPlayer === "white" ? "black" : "white";
          createBoard();
          statusElement.textContent = `${currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1)}'s turn.`;
          clearSelection();
        } else {
          console.log("Invalid move attempted.");
          statusElement.textContent = `Invalid move. It's still ${currentPlayer}'s turn.`;
        }
      } else if (piece) {
        selectPiece(row, col);
      }
    }

    function isCurrentPlayerPiece(piece) {
      return (currentPlayer === "white" && piece === piece.toUpperCase()) ||
             (currentPlayer === "black" && piece === piece.toLowerCase());
    }

    function selectPiece(row, col) {
      selectedPiece = board[row][col];
      selectedPosition = { row, col };
      document.querySelectorAll(".square").forEach((square) => square.classList.remove("selected", "valid-move", "capture"));
      const square = boardElement.children[row * 8 + col];
      square.classList.add("selected");

      if (showGuidelines) {
        highlightValidMoves(row, col);
      }
    }

    function highlightValidMoves(row, col) {
      const moves = getValidMoves(row, col);
      moves.forEach(({ row, col, type }) => {
        const square = boardElement.children[row * 8 + col];
        square.classList.add(type === "capture" ? "capture" : "valid-move");
      });
    }

    function movePiece(row, col) {
      const validMoves = getValidMoves(selectedPosition.row, selectedPosition.col);
      const targetMove = validMoves.find((move) => move.row === row && move.col === col);

      if (targetMove) {
        board[selectedPosition.row][selectedPosition.col] = "";
        board[row][col] = selectedPiece;
        return true;
      }
      return false;
    }

    function getValidMoves(row, col) {
      const piece = board[row][col];
      const moves = [];

      if (!piece) return moves;

      if (piece === PIECES.WHITE_PAWN || piece === PIECES.BLACK_PAWN) {
        moves.push(...getPawnMoves(row, col, piece === PIECES.WHITE_PAWN));
      } else if (piece === PIECES.WHITE_ROOK || piece === PIECES.BLACK_ROOK) {
        moves.push(...getLinearMoves(row, col, [[1, 0], [-1, 0], [0, 1], [0, -1]]));
      } else if (piece === PIECES.WHITE_BISHOP || piece === PIECES.BLACK_BISHOP) {
        moves.push(...getLinearMoves(row, col, [[1, 1], [1, -1], [-1, 1], [-1, -1]]));
      } else if (piece === PIECES.WHITE_QUEEN || piece === PIECES.BLACK_QUEEN) {
        moves.push(...getLinearMoves(row, col, [[1, 0], [-1, 0], [0, 1], [0, -1], [1, 1], [1, -1], [-1, 1], [-1, -1]]));
      } else if (piece === PIECES.WHITE_KING || piece === PIECES.BLACK_KING) {
        moves.push(...getKingMoves(row, col));
      }

      return moves;
    }

    createBoard();
  </script>
</body>

</html>
